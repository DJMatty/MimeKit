<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="MimeKit : A C# MIME creation and parser library with support for S/MIME, PGP and Unix mbox spools." />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>MimeKit</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/jstedfast/MimeKit">View on GitHub</a>

          <h1 id="project_title">MimeKit</h1>
          <h2 id="project_tagline">A C# MIME creation and parser library with support for S/MIME, PGP and Unix mbox spools.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/jstedfast/MimeKit/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/jstedfast/MimeKit/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="mimekit" class="anchor" href="#mimekit"><span class="octicon octicon-link"></span></a>MimeKit</h1>

<h2>
<a name="what-is-mimekit" class="anchor" href="#what-is-mimekit"><span class="octicon octicon-link"></span></a>What is MimeKit?</h2>

<p>MimeKit is a C# library which may be used for the creation and parsing of messages using the Multipurpose Internet Mail Extension (MIME), as defined by the following RFCs:</p>

<ul>
<li>
<a href="http://www.ietf.org/rfc/rfc0822.txt">0822</a>: Standard for the Format of Arpa Internet Text Messages</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1341.txt">1341</a>: MIME (Multipurpose Internet Mail Extensions): Mechanisms for Specifying and Describing the Format of Internet Message Bodies</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1342.txt">1342</a>: Representation of Non-ASCII Text in Internet Message Headers</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1521.txt">1521</a>: MIME (Multipurpose Internet Mail Extensions) Part One: Mechanisms for Specifying and Describing the Format of Internet Message Bodies (Obsoletes rfc1341)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1522.txt">1522</a>: MIME (Multipurpose Internet Mail Extensions) Part Two: Message Header Extensions for Non-ASCII Text (Obsoletes rfc1342)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1544.txt">1544</a>: The Content-MD5 Header Field</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1847.txt">1847</a>: Security Multiparts for MIME: Multipart/Signed and Multipart/Encrypted</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1864.txt">1864</a>: The Content-MD5 Header Field (Obsoletes rfc1544)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2015.txt">2015</a>: MIME Security with Pretty Good Privacy (PGP)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2045.txt">2045</a>: Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2046.txt">2046</a>: Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2047.txt">2047</a>: Multipurpose Internet Mail Extensions (MIME) Part Three: Message Header Extensions for Non-ASCII Text</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2048.txt">2048</a>: Multipurpose Internet Mail Extensions (MIME) Part Four: Registration Procedures</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2049.txt">2049</a>: Multipurpose Internet Mail Extensions (MIME) Part Five: Conformance Criteria and Examples</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2183.txt">2183</a>: Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2184.txt">2184</a>: MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2231.txt">2231</a>: MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations (Obsoletes rfc2184)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2311.txt">2311</a>: S/MIME Version 2 Message Specification</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2312.txt">2312</a>: S/MIME Version 2 Certificate Handling</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2315.txt">2315</a>: PKCS #7: Cryptographic Message Syntax</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2424.txt">2424</a>: Content Duration MIME Header Definition</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2630.txt">2630</a>: Cryptographic Message Syntax</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2632.txt">2632</a>: S/MIME Version 3 Certificate Handling</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2633.txt">2633</a>: S/MIME Version 3 Message Specification</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2634.txt">2634</a>: Enhanced Security Services for S/MIME</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2822.txt">2822</a>: Internet Message Format (Obsoletes rfc0822)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc3156.txt">3156</a>: MIME Security with OpenPGP (Updates rfc2015)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc3850.txt">3850</a>: S/MIME Version 3.1 Certificate Handling (Obsoletes rfc2632)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc3851.txt">3851</a>: S/MIME Version 3.1 Message Specification (Obsoletes rfc2633)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc4262.txt">4262</a>: X.509 Certificate Extension for S/MIME Capabilities</li>
<li>
<a href="http://www.ietf.org/rfc/rfc5322.txt">5322</a>: Internet Message Format (Obsoletes rfc2822) </li>
<li>
<a href="http://www.ietf.org/rfc/rfc5750.txt">5750</a>: S/MIME Version 3.2 Certificate Handling (Obsoletes rfc3850)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc5751.txt">5751</a>: S/MIME Version 3.2 Message Specification (Obsoletes rfc3851)</li>
</ul><h4>
<a name="other-rfcs-of-interest" class="anchor" href="#other-rfcs-of-interest"><span class="octicon octicon-link"></span></a>Other RFCs of interest:</h4>

<ul>
<li>
<a href="http://www.ietf.org/rfc/rfc1523.txt">1523</a>: The text/enriched MIME Content-type</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1872.txt">1872</a>: The MIME Multipart/Related Content-type</li>
<li>
<a href="http://www.ietf.org/rfc/rfc1927.txt">1927</a>: Suggested Additional MIME Types for Associating Documents</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2110.txt">2110</a>: MIME E-mail Encapsulation of Aggregate Documents, such as HTML (MHTML)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2111.txt">2111</a>: Content-ID and Message-ID Uniform Resource Locators</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2112.txt">2112</a>: The MIME Multipart/Related Content-type (Obsoletes rfc1872)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc2387.txt">2387</a>: The MIME Multipart/Related Content-type (Obsoletes rfc2112)</li>
<li>
<a href="http://www.ietf.org/rfc/rfc7103.txt">7103</a>: Advice for Safe Handling of Malformed Messages</li>
</ul><h2>
<a name="license-information" class="anchor" href="#license-information"><span class="octicon octicon-link"></span></a>License Information</h2>

<p>MimeKit is Copyright (C) 2012-2014 Xamarin Inc. and is licensed under the MIT license:</p>

<pre><code>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
</code></pre>

<h2>
<a name="history" class="anchor" href="#history"><span class="octicon octicon-link"></span></a>History</h2>

<p>As a developer and user of Electronic Mail clients, I had come to realize that the vast majority of E-Mail client
(and server) software had less-than-satisfactory MIME implementations. More often than not these E-Mail clients
created broken MIME messages and/or would incorrectly try to parse a MIME message thus subtracting from the full
benefits that MIME was meant to provide. MimeKit is meant to address this issue by following the MIME specification
as closely as possible while also providing programmers with an extremely easy to use high-level API.</p>

<p>This led me, at first, to implement another MIME parser library called <a href="http://spruce.sourceforge.net/gmime">GMime</a>
which is implemented in C and later added a C# binding called GMime-Sharp.</p>

<p>Now that I typically find myself working in C# rather than lower level languages like C, I decided to
begin writing a new parser in C# which would not depend on GMime. This would also allow me to have more
flexibility in that I'd be able use Generics and create a more .NET-compliant API.</p>

<h2>
<a name="installing-via-nuget" class="anchor" href="#installing-via-nuget"><span class="octicon octicon-link"></span></a>Installing via NuGet</h2>

<p>The easiest way to install MimeKit is via <a href="https://www.nuget.org/packages/MimeKit/">NuGet</a>.</p>

<p>In Visual Studio's <a href="http://docs.nuget.org/docs/start-here/using-the-package-manager-console">Package Manager Console</a>,
simply enter the following command:</p>

<pre><code>Install-Package MimeKit
</code></pre>

<h2>
<a name="building" class="anchor" href="#building"><span class="octicon octicon-link"></span></a>Building</h2>

<p>First, you'll need to clone MimeKit and Bouncy Castle from my GitHub repository:</p>

<pre><code>git clone https://github.com/jstedfast/MimeKit.git
git clone https://github.com/jstedfast/bc-csharp.git
</code></pre>

<p>Currently, MimeKit depends on the visual-studio-2010 branch of bc-csharp for the Visual Studio 2010 project
files that I've added (to replace the Visual Studio 2003 project files). To switch to that branch,</p>

<pre><code>cd bc-csharp
git checkout -b visual-studio-2010 origin/visual-studio-2010
</code></pre>

<p>In the top-level MimeKit source directory, there are several solution files:</p>

<ul>
<li>MimeKit.Mobile.sln just includes the Xamarin.iOS and Xamarin.Android projects.</li>
<li>MimeKit.Net40.sln just includes the .NET Framework 4.0 C# project (MimeKit/MimeKit.csproj) and the UnitTests
project (UnitTests/UnitTests.csproj).</li>
<li>MimeKit.sln includes everything that is in the MimeKit.Net40.sln solution as well as the projects for Xamarin.Android,
Xamarin.iOS, and Xamarin.Mac.</li>
</ul><p>If you don't have the Xamarin products, you'll probably want to open the MimeKit.Net40.sln instead of MimeKit.sln.</p>

<p>Once you've opened the appropriate MimeKit solution file in either Xamarin Studio or Visual Studio 2010+ (either will work),
you can simply choose the Debug or Release build configuration and then build.</p>

<p>Note: The Release build will generate the xml API documentation, but the Debug build will not.</p>

<h2>
<a name="using-mimekit" class="anchor" href="#using-mimekit"><span class="octicon octicon-link"></span></a>Using MimeKit</h2>

<h3>
<a name="parsing-messages" class="anchor" href="#parsing-messages"><span class="octicon octicon-link"></span></a>Parsing Messages</h3>

<p>One of the more common operations that MimeKit is meant for is parsing email messages from arbitrary streams.
There are two ways of accomplishing this task.</p>

<p>The first way is to use one of the Load() methods on MimeKit.MimeMessage:</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// Load a MimeMessage from a stream</span>
<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">MimeMessage</span><span class="p">.</span><span class="n">Load</span> <span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</pre></div>

<p>The second way is to use the MimeParser class. For the most part, using the MimeParser directly is not necessary
unless you wish to parse a Unix mbox file stream. However, this is how you would do it:</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// Load a MimeMessage from a stream</span>
<span class="kt">var</span> <span class="n">parser</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MimeParser</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">MimeFormat</span><span class="p">.</span><span class="n">Entity</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">ParseMessage</span> <span class="p">();</span>
</pre></div>

<p>For Unix mbox file streams, you would use the parser like this:</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// Load every message from a Unix mbox</span>
<span class="kt">var</span> <span class="n">parser</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MimeParser</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">MimeFormat</span><span class="p">.</span><span class="n">Mbox</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(!</span><span class="n">parser</span><span class="p">.</span><span class="n">IsEndOfStream</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">ParseMessage</span> <span class="p">();</span>

    <span class="c1">// do something with the message</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="traversing-a-mimemessage" class="anchor" href="#traversing-a-mimemessage"><span class="octicon octicon-link"></span></a>Traversing a MimeMessage</h3>

<p>Once you have parsed a MimeMessage, you'll most likely want to traverse the tree of MIME entities.</p>

<p>The MimeMessage.Body is the top-level MIME entity of the message. Generally, it will either be a
TextPart or a Multipart.</p>

<p>As an example, if you wanted to render the MimeMessage to some sort of UI control, you might
use code similar to this:</p>

<div class="highlight highlight-csharp"><pre><span class="k">void</span> <span class="nf">RenderMessage</span> <span class="p">(</span><span class="n">MimeMessage</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">RenderMimeEntity</span> <span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">Body</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">RenderMimeEntity</span> <span class="p">(</span><span class="n">MimeEntity</span> <span class="n">entity</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="k">is</span> <span class="n">MessagePart</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This entity is an attached message/rfc822 mime part.</span>
        <span class="kt">var</span> <span class="n">messagePart</span> <span class="p">=</span> <span class="p">(</span><span class="n">MessagePart</span><span class="p">)</span> <span class="n">entity</span><span class="p">;</span>

        <span class="c1">// If you'd like to render this inline instead of treating</span>
        <span class="c1">// it as an attachment, you would just continue to recurse:</span>
        <span class="n">RenderMessage</span> <span class="p">(</span><span class="n">messagePart</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="k">is</span> <span class="n">Multipart</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This entity is a multipart container.</span>
        <span class="kt">var</span> <span class="n">multipart</span> <span class="p">=</span> <span class="p">(</span><span class="n">Multipart</span><span class="p">)</span> <span class="n">entity</span><span class="p">;</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">subpart</span> <span class="k">in</span> <span class="n">multipart</span><span class="p">)</span>
            <span class="n">RenderMimeEntity</span> <span class="p">(</span><span class="n">subpart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Everything that isn't either a MessagePart or a Multipart is a MimePart</span>
        <span class="kt">var</span> <span class="n">part</span> <span class="p">=</span> <span class="p">(</span><span class="n">MimePart</span><span class="p">)</span> <span class="n">entity</span><span class="p">;</span>

        <span class="c1">// Don't render anything that is explicitly marked as an attachment.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">part</span><span class="p">.</span><span class="n">IsAttachment</span><span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">part</span> <span class="k">is</span> <span class="n">TextPart</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// This is a mime part with textual content.</span>
            <span class="kt">var</span> <span class="n">text</span> <span class="p">=</span> <span class="p">(</span><span class="n">TextPart</span><span class="p">)</span> <span class="n">part</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">ContentType</span><span class="p">.</span><span class="n">Matches</span> <span class="p">(</span><span class="s">"text"</span><span class="p">,</span> <span class="s">"html"</span><span class="p">))</span>
                <span class="n">RenderHtml</span> <span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="nf">RenderText</span> <span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">ContentType</span><span class="p">.</span><span class="n">Matches</span> <span class="p">(</span><span class="s">"image"</span><span class="p">,</span> <span class="s">"*"</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">content</span> <span class="p">=</span> <span class="n">part</span><span class="p">.</span><span class="n">ContentObject</span><span class="p">.</span><span class="n">Open</span> <span class="p">())</span> <span class="p">{</span>
                <span class="c1">// render the raw image content</span>
                <span class="n">RenderImage</span> <span class="p">(</span><span class="n">content</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="getting-the-decoded-content-of-a-mime-part" class="anchor" href="#getting-the-decoded-content-of-a-mime-part"><span class="octicon octicon-link"></span></a>Getting the Decoded Content of a MIME Part</h3>

<p>At some point, you're going to want to extract the decoded content of a MimePart (such as an image) and
save it to disk or feed it to a UI control to display it.</p>

<p>Once you've found the MimePart object that you'd like to extract the content of, here's how you can
save the decoded content to a file:</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// This will get the name of the file as specified by the sending mail client.</span>
<span class="c1">// Note: this value *may* be null, so you'll want to handle that case in your code.</span>
<span class="kt">var</span> <span class="n">fileName</span> <span class="p">=</span> <span class="n">part</span><span class="p">.</span><span class="n">FileName</span><span class="p">;</span>

<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">Create</span> <span class="p">(</span><span class="n">fileName</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">part</span><span class="p">.</span><span class="n">ContentObject</span><span class="p">.</span><span class="n">DecodeTo</span> <span class="p">(</span><span class="n">stream</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>You can also get access to the original encoded content and its encoding by "opening" the ContentObject.
This might be useful if you want to pass the content off to a UI control that can do its own loading
from a stream.</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="n">part</span><span class="p">.</span><span class="n">ContentObject</span><span class="p">.</span><span class="n">Open</span> <span class="p">())</span> <span class="p">{</span>
    <span class="c1">// At this point, you can now read from the stream as if it were the original,</span>
    <span class="c1">// raw content. Assuming you have an image UI control that could load from a</span>
    <span class="c1">// stream, you could do something like this:</span>
    <span class="n">imageControl</span><span class="p">.</span><span class="n">Load</span> <span class="p">(</span><span class="n">stream</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>There are a number of useful filters that can be applied to a FilteredStream, so if you find this type of
interface appealing, I suggest taking a look at the available filters in the MimeKit.IO.Filters namespace
or even write your own! The possibilities are limited only by your imagination.</p>

<h3>
<a name="creating-a-simple-message" class="anchor" href="#creating-a-simple-message"><span class="octicon octicon-link"></span></a>Creating a Simple Message</h3>

<p>Creating MIME messages using MimeKit is really trivial.</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MimeMessage</span> <span class="p">();</span>
<span class="n">message</span><span class="p">.</span><span class="n">From</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="k">new</span> <span class="n">MailboxAddress</span> <span class="p">(</span><span class="s">"Joey"</span><span class="p">,</span> <span class="s">"joey@friends.com"</span><span class="p">));</span>
<span class="n">message</span><span class="p">.</span><span class="n">To</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="k">new</span> <span class="n">MailboxAddress</span> <span class="p">(</span><span class="s">"Alice"</span><span class="p">,</span> <span class="s">"alice@wonderland.com"</span><span class="p">));</span>
<span class="n">message</span><span class="p">.</span><span class="n">Subject</span> <span class="p">=</span> <span class="s">"How you doin?"</span><span class="p">;</span>

<span class="n">message</span><span class="p">.</span><span class="n">Body</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TextPart</span> <span class="p">(</span><span class="s">"plain"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Text</span> <span class="p">=</span> <span class="s">@"Hey Alice,</span>

<span class="s">What are you up to this weekend? Monica is throwing one of her parties on</span>
<span class="s">Saturday and I was hoping you could make it.</span>

<span class="s">Will you be my +1?</span>

<span class="s">-- Joey</span>
<span class="s">"</span>
<span class="p">};</span>
</pre></div>

<p>A TextPart is a leaf-node MIME part with a text media-type. The first argument to the TextPart constructor
specifies the media-subtype, in this case, "plain". Another media subtype you are probably familiar with
is the "html" subtype. Some other examples include "enriched" and "csv".</p>

<p>The Text property is the easiest way to both get and set the string content of the MIME part.</p>

<h3>
<a name="creating-a-message-with-attachments" class="anchor" href="#creating-a-message-with-attachments"><span class="octicon octicon-link"></span></a>Creating a Message with Attachments</h3>

<p>Attachments are just like any other MimePart, the only difference is that they typically have
a Content-Disposition header with a value of "attachment" instead of "inline" or no
Content-Disposition header at all.</p>

<p>Typically, when a mail client adds attachments to a message, it will create a multipart/mixed
part and add the text body part and all of the file attachments to the multipart/mixed.</p>

<p>Here's how you can do that with MimeKit:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MimeMessage</span> <span class="p">();</span>
<span class="n">message</span><span class="p">.</span><span class="n">From</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="k">new</span> <span class="n">MailboxAddress</span> <span class="p">(</span><span class="s">"Joey"</span><span class="p">,</span> <span class="s">"joey@friends.com"</span><span class="p">));</span>
<span class="n">message</span><span class="p">.</span><span class="n">To</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="k">new</span> <span class="n">MailboxAddress</span> <span class="p">(</span><span class="s">"Alice"</span><span class="p">,</span> <span class="s">"alice@wonderland.com"</span><span class="p">));</span>
<span class="n">message</span><span class="p">.</span><span class="n">Subject</span> <span class="p">=</span> <span class="s">"How you doin?"</span><span class="p">;</span>

<span class="c1">// create our message text, just like before (except don't set it as the message.Body)</span>
<span class="kt">var</span> <span class="n">body</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TextPart</span> <span class="p">(</span><span class="s">"plain"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Text</span> <span class="p">=</span> <span class="s">@"Hey Alice,</span>

<span class="s">What are you up to this weekend? Monica is throwing one of her parties on</span>
<span class="s">Saturday and I was hoping you could make it.</span>

<span class="s">Will you be my +1?</span>

<span class="s">-- Joey</span>
<span class="s">"</span>
<span class="p">};</span>

<span class="c1">// create an image attachment for the file located at path</span>
<span class="kt">var</span> <span class="n">attachment</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MimePart</span> <span class="p">(</span><span class="s">"image"</span><span class="p">,</span> <span class="s">"gif"</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ContentObject</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ContentObject</span> <span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span> <span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">ContentEncoding</span><span class="p">.</span><span class="n">Default</span><span class="p">),</span>
    <span class="n">ContentDisposition</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ContentDisposition</span> <span class="p">(</span><span class="n">ContentDisposition</span><span class="p">.</span><span class="n">Attachment</span><span class="p">),</span>
    <span class="n">FileName</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">GetFileName</span> <span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="p">};</span>

<span class="c1">// now create the multipart/mixed container to hold the message text and the</span>
<span class="c1">// image attachment</span>
<span class="kt">var</span> <span class="n">multipart</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Multipart</span> <span class="p">(</span><span class="s">"mixed"</span><span class="p">);</span>
<span class="n">multipart</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">body</span><span class="p">);</span>
<span class="n">multipart</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">attachment</span><span class="p">);</span>

<span class="c1">// now set the multipart/mixed as the message body</span>
<span class="n">message</span><span class="p">.</span><span class="n">Body</span> <span class="p">=</span> <span class="n">multipart</span><span class="p">;</span>
</pre></div>

<p>Of course, that is just a simple example. A lot of modern mail clients such as Outlook or Thunderbird will 
send out both a text/html and a text/plain version of the message text. To do this, you'd create a TextPart
for the text/plain part and a TextPart for the text/html part and then add them to a multipart/alternative
like so:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">attachment</span> <span class="p">=</span> <span class="n">CreateAttachment</span> <span class="p">();</span>
<span class="kt">var</span> <span class="n">plain</span> <span class="p">=</span> <span class="n">CreateTextPlainPart</span> <span class="p">();</span>
<span class="kt">var</span> <span class="n">html</span> <span class="p">=</span> <span class="n">CreateTextHtmlPart</span> <span class="p">();</span>

<span class="c1">// Note: it is important that the text/html part is added second, because it is the</span>
<span class="c1">// most expressive version and (probably) the most faithful to the sender's WYSIWYG </span>
<span class="c1">// editor.</span>
<span class="kt">var</span> <span class="n">alternative</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Multipart</span> <span class="p">(</span><span class="s">"alternative"</span><span class="p">);</span>
<span class="n">alternative</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">plain</span><span class="p">);</span>
<span class="n">alternative</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">html</span><span class="p">);</span>

<span class="c1">// now create the multipart/mixed container to hold the multipart/alternative</span>
<span class="c1">// and the image attachment</span>
<span class="kt">var</span> <span class="n">multipart</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Multipart</span> <span class="p">(</span><span class="s">"mixed"</span><span class="p">);</span>
<span class="n">multipart</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">alternative</span><span class="p">);</span>
<span class="n">multipart</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">attachment</span><span class="p">);</span>

<span class="c1">// now set the multipart/mixed as the message body</span>
<span class="n">message</span><span class="p">.</span><span class="n">Body</span> <span class="p">=</span> <span class="n">multipart</span><span class="p">;</span>
</pre></div>

<h3>
<a name="digitally-signing-messages-with-smime-or-pgpmime" class="anchor" href="#digitally-signing-messages-with-smime-or-pgpmime"><span class="octicon octicon-link"></span></a>Digitally Signing Messages with S/MIME or PGP/MIME</h3>

<p>Both S/MIME and PGP/MIME use a multipart/signed to contain the signed content and the detached signature data.</p>

<p>To create a multipart/signed MIME part, let's pretend we're going to digitally sign our multipart/mixed example
from the previous sample using S/MIME.</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">joey</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MailboxAddress</span> <span class="p">(</span><span class="s">"Joey"</span><span class="p">,</span> <span class="s">"joey@friends.com"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">alice</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MailboxAddress</span> <span class="p">(</span><span class="s">"Alice"</span><span class="p">,</span> <span class="s">"alice@wonderland.com"</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MimeMessage</span> <span class="p">();</span>
<span class="n">message</span><span class="p">.</span><span class="n">From</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">joey</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">To</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">alice</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">Subject</span> <span class="p">=</span> <span class="s">"How you doin?"</span><span class="p">;</span>

<span class="c1">// create our message body (perhaps a multipart/mixed with the message text and some</span>
<span class="c1">// image attachments, for example)</span>
<span class="kt">var</span> <span class="n">body</span> <span class="p">=</span> <span class="n">CreateMessageBody</span> <span class="p">();</span>

<span class="c1">// now to digitally sign our message body using the default S/MIME cryptography context</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ctx</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DefaultSecureMimeContext</span> <span class="p">())</span> <span class="p">{</span>
    <span class="c1">// Note: this assumes that "Joey" has an S/MIME signing certificate and private key</span>
    <span class="c1">// with an X.509 Subject Email identifier that matches Joey's email address.</span>
    <span class="n">message</span><span class="p">.</span><span class="n">Body</span> <span class="p">=</span> <span class="n">MultipartSigned</span><span class="p">.</span><span class="n">Create</span> <span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">joey</span><span class="p">,</span> <span class="n">DigestAlgorithm</span><span class="p">.</span><span class="n">Sha1</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>For S/MIME, if you have a way for the user to configure which S/MIME certificate to use
as their signing certificate, you could also do something more like this:</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// now to digitally sign our message body using the default S/MIME cryptography context</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ctx</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DefaultSecureMimeContext</span> <span class="p">())</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">certificate</span> <span class="p">=</span> <span class="n">GetJoeysX509Certificate</span> <span class="p">();</span>
    <span class="kt">var</span> <span class="n">signer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CmsSigner</span> <span class="p">(</span><span class="n">certificate</span><span class="p">);</span>
    <span class="n">signer</span><span class="p">.</span><span class="n">DigestAlgorithm</span> <span class="p">=</span> <span class="n">DigestAlgorithm</span><span class="p">.</span><span class="n">Sha1</span><span class="p">;</span>

    <span class="n">message</span><span class="p">.</span><span class="n">Body</span> <span class="p">=</span> <span class="n">MultipartSigned</span><span class="p">.</span><span class="n">Create</span> <span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">signer</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you'd prefer to use PGP instead of S/MIME, things work almost exactly the same except that you
would use an OpenPGP cryptography context. For example, you might use a subclass of the
GnuPGContext that comes with MimeKit if you want to re-use the user's GnuPG keyrings (you can't
use GnuPGContext directly because it has no way of prompting the user for their passphrase).</p>

<p>For the sake of this example, let's pretend that you've written a minimal subclass of
MimeKit.Cryptography.GnuPGContext that simply overrides the GetPassword() method and
that this subclass is called MyGnuPGContext.</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// now to digitally sign our message body using our custom OpenPGP cryptography context</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ctx</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyGnuPGContext</span> <span class="p">())</span> <span class="p">{</span>
    <span class="c1">// Note: this assumes that "Joey" has a PGP key that matches his email address.</span>
    <span class="n">message</span><span class="p">.</span><span class="n">Body</span> <span class="p">=</span> <span class="n">MultipartSigned</span><span class="p">.</span><span class="n">Create</span> <span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">joey</span><span class="p">,</span> <span class="n">DigestAlgorithm</span><span class="p">.</span><span class="n">Sha1</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Just like S/MIME, however, you can also do your own PGP key lookups instead of
relying on email addresses to match up with the user's private key.</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// now to digitally sign our message body using our custom OpenPGP cryptography context</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ctx</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyGnuPGContext</span> <span class="p">())</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">key</span> <span class="p">=</span> <span class="n">GetJoeysPrivatePgpKey</span> <span class="p">();</span>
    <span class="n">message</span><span class="p">.</span><span class="n">Body</span> <span class="p">=</span> <span class="n">MultipartSigned</span><span class="p">.</span><span class="n">Create</span> <span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">DigestAlgorithm</span><span class="p">.</span><span class="n">Sha1</span><span class="p">,</span> <span class="n">body</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="verifying-smime-and-pgpmime-digital-signatures" class="anchor" href="#verifying-smime-and-pgpmime-digital-signatures"><span class="octicon octicon-link"></span></a>Verifying S/MIME and PGP/MIME Digital Signatures</h3>

<p>As mentioned earlier, both S/MIME and PGP/MIME typically use a multipart/signed part to contain the
signed content and the detached signature data.</p>

<p>A multipart/signed contains exactly 2 parts: the first MimeEntity is the signed content while the second
MimeEntity is the detached signature and, by default, will either be an ApplicationPgpSignature part or
an ApplicationPkcs7Signature part (depending on whether the sending client signed using OpenPGP or S/MIME).</p>

<p>Because the multipart/signed part may have been signed by multiple signers, it is important to
verify each of the digital signatures (one for each signer) that are returned by the
MultipartSigned.Verify() method:</p>

<div class="highlight highlight-csharp"><pre><span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="k">is</span> <span class="n">MultipartSigned</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">signed</span> <span class="p">=</span> <span class="p">(</span><span class="n">MultipartSigned</span><span class="p">)</span> <span class="n">entity</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">signature</span> <span class="k">in</span> <span class="n">signed</span><span class="p">.</span><span class="n">Verify</span> <span class="p">())</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">valid</span> <span class="p">=</span> <span class="n">signature</span><span class="p">.</span><span class="n">Verify</span> <span class="p">();</span>

            <span class="c1">// If valid is true, then it signifies that the signed content has not been</span>
            <span class="c1">// modified since this particular signer signed the content.</span>
            <span class="c1">//</span>
            <span class="c1">// However, if it is false, then it indicates that the signed content has</span>
            <span class="c1">// been modified.</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">DigitalSignatureVerifyException</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// There was an error verifying the signature.</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>It should be noted, however, that while most S/MIME clients will use the preferred multipart/signed
approach, it is possible that you may encounter an "application/pkcs7-mime" part with an
"smime-type" parameter set to "signed-data". Luckily, MimeKit can handle this format as well:</p>

<div class="highlight highlight-csharp"><pre><span class="k">if</span> <span class="p">(</span><span class="n">entity</span> <span class="k">is</span> <span class="n">ApplicationPkcs7Mime</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">pkcs7</span> <span class="p">=</span> <span class="p">(</span><span class="n">ApplicationPkcs7Mime</span><span class="p">)</span> <span class="n">entity</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pkcs7</span><span class="p">.</span><span class="n">SecureMimeType</span> <span class="p">==</span> <span class="n">SecureMimeType</span><span class="p">.</span><span class="n">SignedData</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// extract the original content and get a list of signatures</span>
        <span class="n">MimeEntity</span> <span class="n">extracted</span><span class="p">;</span>

        <span class="c1">// Note: if you are rendering the message, you'll want to render</span>
        <span class="c1">// the extracted mime part rather than the application/pkcs7-mime part.</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">signature</span> <span class="k">in</span> <span class="n">pkcs7</span><span class="p">.</span><span class="n">Verify</span> <span class="p">(</span><span class="k">out</span> <span class="n">extracted</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kt">bool</span> <span class="n">valid</span> <span class="p">=</span> <span class="n">signature</span><span class="p">.</span><span class="n">Verify</span> <span class="p">();</span>

                <span class="c1">// If valid is true, then it signifies that the signed content has not</span>
                <span class="c1">// been modified since this particular signer signed the content.</span>
                <span class="c1">//</span>
                <span class="c1">// However, if it is false, then it indicates that the signed content</span>
                <span class="c1">// has been modified.</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">DigitalSignatureVerifyException</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// There was an error verifying the signature.</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>The first thing you'll need to do is fork MimeKit to your own GitHub repository. Once you do that,</p>

<pre><code>git clone git@github.com/&lt;your-account&gt;/MimeKit.git
</code></pre>

<p>If you use <a href="http://xamarin.com/studio">Xamarin Studio</a> or <a href="http://monodevelop.org">MonoDevelop</a>, all of the
solution files are configured with the coding style used by MimeKit. If you use Visual Studio or some
other editor, please try to maintain the existing coding style as best as you can.</p>

<p>Once you've got some changes that you'd like to submit upstream to the official MimeKit repository,
simply send me a Pull Request and I will try to review your changes in a timely manner.</p>

<h2>
<a name="reporting-bugs" class="anchor" href="#reporting-bugs"><span class="octicon octicon-link"></span></a>Reporting Bugs</h2>

<p>Have a bug or a feature request? <a href="https://github.com/jstedfast/MimeKit/issues">Please open a new issue</a>.</p>

<p>Before opening a new issue, please search for existing issues to avoid submitting duplicates.</p>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<p>API documentation can be found at <a href="http://jstedfast.github.io/MimeKit/docs">http://jstedfast.github.io/MimeKit/docs</a>.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">MimeKit maintained by <a href="https://github.com/jstedfast">jstedfast</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
